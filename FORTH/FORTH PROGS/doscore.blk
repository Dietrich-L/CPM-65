( FORTH DOS Kernel V1.0                           )             VOCABULARY DOS IMMEDIATE HEX DOS DEFINITIONS                    : FCB1 F6 @ ;                                                   : FCB2 F4 @ ;                                                   : DIR-BUF FC @ ;                                                : SET-DMA FE ! ;                                                : ?DISK-ERR IF ." Disk Error " HEX 0 <# # # #>                                 TYPE CR ABORT ENDIF ;                            FORTH DEFINITIONS                                               : UCASE DUP 60 > OVER 7B < AND IF 5F AND ENDIF ;                : 2DUP over over ;                                              : 2SWAP rot >R rot R> ;                                         DOS DEFINITIONS                                                                                                                 -->                                                                                                                             ( BDOS COMMANDS  )                                              : OPEN-FILE 0 0F BDOS ;                                         : CLOSE     0 10 BDOS ?DISK-ERR DROP ;                          : SEARCH0   0 11 BDOS >R 0 100 U/ SWAP DROP R> ?DISK-ERR ;      : SEARCH    0 12 BDOS >R 0 100 U/ SWAP DROP R> ;                : READ      0 14 BDOS ;                                         : WRITE     0 15 BDOS ?DISK-ERR DROP ;                          : MAKE-FILE 0 16 BDOS ;                                                                                                         -->                                                                                                                                                                                                                                                                                                                                                                                                                                                             ( FCB HANDLING )                                                : (!FCB)        ( ADDR LEN FCB-ADDR -   )                         DUP 10 ERASE DUP 1+ 0B BLANKS    ( LOESCHT FCB )                >R OVER 1+ C@ 3A =              ( PRUEFT ": )                   IF OVER C@ 40 - R C! 2 - SWAP 2 + SWAP ENDIF ( DRIVE )          R> 1+ ROT ROT 0 DO           ( SETZE FILENAME )                   DUP C@ 2E = IF SWAP 8 I - +  ( WENN . )                           ELSE 2DUP C@ UCASE SWAP C! SWAP 1+ ENDIF                    SWAP 1+ LOOP DROP DROP ;      ( DROP FCB-ADDR ADDR )                                                                          : !FCB BL WORD HERE COUNT ROT (!FCB) ;                          -->                                                                                                                                                                                                                                                                                                                             ( SYSTEM COMMANDS FOR FORTH )                                   FORTH DEFINITIONS                                               : BYE 0 0 BDOS ;                                                IMMEDIATE                                                       : SAVE-SYSTEM      ( SAVE SYSTEM IMAGE OF ACTUAL FORTH )            DOS FCB1 !FCB MAKE-FILE ?DISK-ERR DROP                          HERE 200 DO I SET-DMA WRITE 100 +LOOP CLOSE ;               DECIMAL                                                         -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ( NDOS.BLK   MORE DOS DEFINITIONS )                             FORTH DEFINITIONS HEX                                           : OPEN                                                            DOS FCB1 !FCB OPEN-FILE ?DISK-ERR DROP LO DUP SET-DMA EOM !     BEGIN READ SWAP OVER IF DUP D7 =                                IF DROP ELSE SWAP ?DISK-ERR ENDIF ELSE                          DROP EOM @ B/BUF + DUP EOM ! SET-DMA ENDIF UNTIL                EMPTY-BUFFERS ;                                               -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ( DOS UTILITIES )                                               : autoexec -find drop drop cfa                                      ' QUIT cfa 0E + ! save-system ;                                                                                             -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ( MORE DOS )                                                                                                                    FORTH DEFINITIONS DECIMAL                                       LATEST   12 +ORIGIN !   ( TOP NFA )                             HERE     30 +ORIGIN !   ( DP )                                  ' DOS     6 +ORIGIN !   ( VOC-LINK )                                                                                              ;S                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            